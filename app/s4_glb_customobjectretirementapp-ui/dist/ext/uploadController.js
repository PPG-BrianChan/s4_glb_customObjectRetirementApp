sap.ui.define(["sap/m/MessageBox","sap/m/MessageToast"],function(e,o){"use strict";function n(o,n){var t;function r(e){t&&t.getBeginButton().setEnabled(e)}function a(e){t.setBusy(e)}function l(){t&&t.close()}function s(o){e.error(o||"Upload failed")}function i(e){return sap.ui.core.Fragment.byId("uploadDialog",e)}return{onBeforeOpen:function(e){t=e.getSource();o.addDependent(t)},onAfterClose:function(e){o.removeDependent(t);t.destroy();t=undefined},onOk:function(e){a(true);var n=i("uploader");var t=o._controller.extensionAPI._controller._oAppComponent.getManifestObject()._oBaseUri._string;console.log("Base URL:",t);if(!t.includes("port4004-workspaces-ws")){var r=n.getUploadUrl();console.log("Original URL:",r);var l=o._controller.extensionAPI._controller._oAppComponent.getManifestObject().resolveUri("./main/excelUpload/excel");n.setUploadUrl(l);console.log("Upload URL:",l)}n.checkFileReadable().then(function(){n.upload()}).catch(function(e){s("The file cannot be read.");a(false)})},onCancel:function(e){l()},onTypeMismatch:function(e){var o=e.getSource().getFileType().map(function(e){return"*."+e}).join(", ");s("The file type *."+e.getParameter("fileType")+" is not supported. Choose one of the following types: "+o)},onFileAllowed:function(e){r(true)},onFileEmpty:function(e){r(false)},onUploadComplete:function(n){var t=n.getParameters();console.log("Testing all param:",t);var i=n.getParameter("status");console.log("Status:",i);var c=n.getSource();c.clear();r(false);a(false);if(i>=400){var u;try{u=JSON.parse(n.getParameter("responseRaw"))}catch(e){u=n.getParameter("responseRaw")}if(typeof u=="object"){if(u&&u.error&&u.error.message){s(`Error occured during upload. Status:${u.error.code}. Message:${u.error.message}`)}}else{s(`Error occured during upload with unparsed error:${u}`)}}else{e.success("Uploaded successfully. Please check in console to identify if invalid entries exist!");o.refresh();l()}}}}return{showUploadDialog:function(e,o){this.loadFragment({id:"uploadDialog",name:"objectRetirementApp.s4glbcustomobjectretirementappui.ext.uploadDialog",controller:n(this)}).then(function(e){e.open()})}}});